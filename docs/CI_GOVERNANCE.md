# CI Governance

## Package Lock Management

### ⚠️ CRITICAL: Do Not Hand-Edit package-lock.json

**NEVER manually edit `package-lock.json`**. This file is automatically generated and must remain synchronized with `package.json` across all workspaces.

### ✅ Correct Workflow

1. **Update dependencies**: Modify `package.json` files in submodules
2. **Regenerate lock**: Run `npm install --workspaces` from integration root
3. **Commit changes**: Include both `package.json` and `package-lock.json` changes
4. **Verify CI**: Ensure CI passes before merging

### 🔧 Workspace Commands

```bash
# From integration root
npm install --workspaces          # Regenerate lock across all workspaces
npm ci --ignore-scripts          # Verify lock matches package.json
npm audit fix                    # Apply non-breaking security fixes
```

### 🚨 Common Issues

- **CI fails with npm ci errors**: Lock file out of sync with package.json
- **Missing dependencies**: Submodule updated but root lock not regenerated
- **Version conflicts**: Multiple package.json files specify different versions

### 📋 CI Validation

The CI pipeline includes automatic validation:

- `npm ci --ignore-scripts` verifies lock file consistency
- Workspace dependency resolution is checked
- Submodule synchronization is validated

### 🔄 Recovery Process

If lock file becomes corrupted:

1. Delete `node_modules` and `package-lock.json`
2. Run `npm install --workspaces`
3. Commit the regenerated `package-lock.json`
4. Verify CI passes

---

**Last Updated**: October 3, 2025  
**Related**: PR #30 (lockfile synchronization fix)
